name: Run Tests
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.3'  # Spécifier une version exacte
          channel: 'stable'

      - name: Clear Pub Cache
        run: rm -rf $HOME/.pub-cache

      - name: Generate mocks locally
        run: |
          # Créer un dossier temporaire pour les fichiers générés
          mkdir -p .dart_tool/build/generated
          
          # Chercher les fichiers .mock.dart existants dans le projet
          find . -name "*.mock.dart" -type f -exec cp {} .dart_tool/build/generated/ \;
          
          # S'il n'y a pas de fichiers mock disponibles, créer des stubs vides
          mkdir -p test/mocks
          touch test/mocks/.placeholder

      - name: Install Dependencies
        run: flutter pub get

      - name: Skip build_runner
        run: echo "Skipping build_runner to avoid compatibility issues"

      - name: Run Tests
        run: flutter test

